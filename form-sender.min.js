/*!
 * Landing page CMS client-side app v2.1.0
 *
 * http://marketing-na100.ru/
 *
 * changes in v2.1.0:
 * - uses a default bootstrap modal plugin to dial with dialogs
 * - phone fields are required only
 *
 * Copyright (c) 2015 Roman Proshin
 */
/**
 * @param {{[urlHost]: string, [paramDomain]: null, [getYaCounter]: Function,
 * [fmRequest]: (*|jQuery|HTMLElement), [fmThanks]: (*|jQuery|HTMLElement),
 * onOpenDialog: onOpenDialog}} customOptions
 * @constructor
 */
var LPCMSApp=function(a){function e(){$("[data-type]").click(function(a){a.preventDefault();var e=$(this),t=e.data("title"),o=e.data("type"),i=e.data("btn"),r=e.data("yagoal"),l=[];e.data("optional-names")&&l.push(e.data("optional-names"));var s="",u=n.fmRequest;$(u).find("input").val(""),$(u).find(".ignore").removeClass("ignore"),$(u).find("input[name=type]").val(o),$(u).find("input[name=yagoal]").val(r);for(var d in l)l.hasOwnProperty(d)&&$(u).find("input[name="+l[d]+"]").addClass("ignore");return n.onOpenDialog(t,i,s),$(n.fmRequest).modal("show"),!1}),$("form").each(function(){$(this).find("[type=file]").change(function(){this.files&&this.files[0]&&this.files[0].size>26214400&&(alert("Превышен размер файла! Максимальный допустимый размер - 25 мегабайт."),$(this).val(null))}),$(this).validate({debug:!0,submitHandler:function(a){var e=$(a),t=new FormData($(a)[0]);jQuery.ajax({url:n.urlHost+"/app/api/requests/new",data:t,cache:!1,contentType:!1,processData:!1,type:"POST",success:function(){$(n.fmRequest).modal("hide");var a=jQuery(".modal.in").attr("id");a&&jQuery("#"+a).modal("hide"),n.fmThanks&&($(n.fmThanks).modal("show"),setTimeout(function(){$(n.fmThanks).modal("hide")},3e3))},statusCode:{413:function(){alert("Превышен максимальный размер файла в 25 мегабайт!")},415:function(){alert("Неправильный формат файла! Разрешена отправка только изображений.")}}});try{var o=e.find("[name=yagoal]").val();n.getYaCounter&&o&&n.getYaCounter().reachGoal&&n.getYaCounter().reachGoal(o)}catch(i){window.console&&window.console.error("Can not send a Yandex Goal",i)}return!1},ignore:".ignore",errorPlacement:function(a,e){$(e).attr("title",$(a).text())},rules:{phone:"required",email:"email"},messages:{phone:{required:"Пожалуйста, укажите Ваш телефонный номер"},email:{email:"Пожалуйста, укажите корректный адрес электронной почты"}}})})}var t={urlHost:"http://"+location.host,paramDomain:null,getYaCounter:null,fmRequest:$("#fmRequest"),fmThanks:$("#fmThanks"),onOpenDialog:function(){}},n=$.extend({},t,a);e()};