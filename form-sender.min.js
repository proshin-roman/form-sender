/*!
 * Form sender v3.1.2
 *
 * Copyright (c) 2015 Roman Proshin
 */
var FormSender=function(e){function n(){$("[data-type]").unbind().click(function(e){e.preventDefault();var n=$(this),a=n.data("type"),i=n.data("yagoal"),r=n.data("modal"),l=[];n.data("optional-names")&&l.push(n.data("optional-names"));var u=r?$("#"+r):o.fmRequest;$(u).find("input").val(""),$(u).find(".ignore").removeClass("ignore"),t(u,"type"),t(u,"yagoal"),$(u).find("input[name=type]").val(a),$(u).find("input[name=yagoal]").val(i);for(var s in l)l.hasOwnProperty(s)&&$(u).find("input[name="+l[s]+"]").addClass("ignore");return o.onOpenDialog(u,n),$(u).modal(),!1})}function t(e,n){0===$(e).find("input[name="+n+"]").length&&$(e).append($("<input/>",{type:"hidden",name:n}))}function a(){$("form").each(function(){$(this).find("[type=file]").change(function(){this.files&&this.files[0]&&this.files[0].size>26214400&&(alert("Превышен размер файла! Максимальный допустимый размер - 25 мегабайт."),$(this).val(null))}),$(this).validate({submitHandler:function(e){var n=$(e),t=new FormData($(e)[0]);t.append("referrer",o.referrer),jQuery.ajax({url:o.url,data:t,cache:!1,contentType:!1,processData:!1,type:"POST",success:function(e){$(o.fmRequest).modal("hide"),o.onSendRequest&&o.onSendRequest(),n.find("input[type=text]").val("")},statusCode:{413:function(){alert("Превышен максимальный размер файла в 25 мегабайт!")},415:function(){alert("Неправильный формат файла! Разрешена отправка только изображений.")}}});try{var a=n.find("[name=yagoal]").val();o.getYaCounter&&a&&o.getYaCounter().reachGoal&&o.getYaCounter().reachGoal(a)}catch(i){window.console&&window.console.error("Can not send a Yandex Goal",i)}return!1},ignore:".ignore",errorPlacement:function(e,n){$(n).attr("title",$(e).text())},rules:{phone:"required",email:"email"},messages:{phone:{required:"Пожалуйста, укажите Ваш телефонный номер"},email:{email:"Пожалуйста, укажите корректный адрес электронной почты"}}})})}var i={url:"http://"+location.host+"/app/api/requests/new",referrer:location.host,getYaCounter:null,fmRequest:$("#fmRequest"),onSendRequest:function(){},onOpenDialog:function(e,n){}},o=$.extend({},i,e);this.rebindButtons=function(){n()},n(),a()};