/*!
 * Form sender v3.0.0
 *
 * Copyright (c) 2015 Roman Proshin
 */
/**
 * @param {{[url]: string, [referrer]: null, [getYaCounter]: function, [fmRequest]: (*|jQuery|HTMLElement), [fmThanks]: (*|jQuery|HTMLElement|function), [onSendRequest]: function, onOpenDialog: function}} customOptions
 * @constructor
 */
var FormSender=function(e){function a(){$("[data-type]").click(function(e){e.preventDefault();var a=$(this),n=a.data("title"),o=a.data("type"),r=a.data("btn"),i=a.data("yagoal"),l=[];a.data("optional-names")&&l.push(a.data("optional-names"));var s="",u=t.fmRequest;$(u).find("input").val(""),$(u).find(".ignore").removeClass("ignore"),$(u).find("input[name=type]").val(o),$(u).find("input[name=yagoal]").val(i);for(var d in l)l.hasOwnProperty(d)&&$(u).find("input[name="+l[d]+"]").addClass("ignore");return t.onOpenDialog(n,r,s),$(t.fmRequest).modal("show"),!1}),$("form").each(function(){$(this).find("[type=file]").change(function(){this.files&&this.files[0]&&this.files[0].size>26214400&&(alert("Превышен размер файла! Максимальный допустимый размер - 25 мегабайт."),$(this).val(null))}),$(this).validate({submitHandler:function(e){var a=$(e),n=new FormData($(e)[0]);n.append("referrer",t.referrer),jQuery.ajax({url:t.url,data:n,cache:!1,contentType:!1,processData:!1,type:"POST",success:function(e){$(t.fmRequest).modal("hide"),t.onSendRequest&&t.onSendRequest()},statusCode:{413:function(){alert("Превышен максимальный размер файла в 25 мегабайт!")},415:function(){alert("Неправильный формат файла! Разрешена отправка только изображений.")}}});try{var o=a.find("[name=yagoal]").val();t.getYaCounter&&o&&t.getYaCounter().reachGoal&&t.getYaCounter().reachGoal(o)}catch(r){window.console&&window.console.error("Can not send a Yandex Goal",r)}return!1},ignore:".ignore",errorPlacement:function(e,a){$(a).attr("title",$(e).text())},rules:{phone:"required",email:"email"},messages:{phone:{required:"Пожалуйста, укажите Ваш телефонный номер"},email:{email:"Пожалуйста, укажите корректный адрес электронной почты"}}})})}var n={url:"http://"+location.host+"/app/api/requests/new",referrer:location.host,getYaCounter:null,fmRequest:$("#fmRequest"),onSendRequest:function(){},onOpenDialog:function(e,a,n){}},t=$.extend({},n,e);a()};